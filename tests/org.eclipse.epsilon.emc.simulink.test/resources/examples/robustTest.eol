/* MATLAB CODE :

h=new_system('a')
add_param('a','a','2')
open_system('a')

add_block('simulink/User-Defined Functions/MATLAB Function','a/ss')
add_block('simulink/Signal Routing/Data Store Memory','a/as')
rt=slroot;
bl=rt.find('-isa','Stateflow.EMChart','Name','ss')

bl.Script="global bb;"

data_new = Stateflow.Data(bl)
data_new.Name = 'bb';
data_new.Scope='Data Store Memory';
*/

" >> Define matlab function that contains a global variable a".println;

" >> Create all necessary objects".println;

var simufc = new `simulink/User-Defined Functions/MATLAB Function`;
assert(simufc <> null);

var store1 = new `simulink/Signal Routing/Data Store Memory`;
assert(store1 <> null);

// CHART Version 
var chart = new `sflib/Chart`; // Temporary FIX 
assert(chart <> null); 

var data_new = new `Stateflow.Data`;
chart.add(data_new); // Same as data_new.parent = chart;
assert(data_new <> null);
assert(Data.all.first() <> null);

// EMChart Version
var emChart = EMChart.all.first();
assert(emChart <> null);

var data_new_2 = new `Stateflow.Data`;
//data_new_2.parent = emChart; 
emChart.add(data_new_2);

" >> setting properties".println;

simufc.Script="global a;"+"\\n"+"a=a+1;"; // Double '\'
simufc.Script.println;

emChart.Script = "global bb;";
assert(emChart.Script.println = "global bb;");

store1.position = "[100 100 130 130]";
store1.position.println;

store1.name="a";
assert(store1.name.println = "a");

store1.InitialValue=2;
store1.InitialValue.println;

data_new.Name = 'bb';
data_new.name.println;

data_new.Scope='Data Store Memory';
data_new.Scope.println;

"finished".println;